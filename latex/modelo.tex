\subsection{Video}

Definiremos un modelo para los videos con el cual sea fácil de trabajar a la hora de realizar
el \textit{slow motion}.
Dado un video, definiremos:
\begin{itemize}
    \item $w$ el ancho en píxeles de cada frame.
    \item $h$ el ancho en píxeles de cada frame.
    \item $f_i$ el $i$-ésimo frame, con $0< i < k$, donde k es la cantidad de frames totales.
    \item $p(x,y,f_i)$, con $0 < x < w$, $0< y < h$, el píxel en la posición $(x,y)$ del frame $f_i$.
\end{itemize}

Luego, si tomamos $p(x,y,f_i)$ y $p(x,y,f_{i+1})$ querremos agregar una cierta cantidad
de píxeles entre ambos, de forma que haya una transición del primero al segundo y
se produzca el \textit{slow motion}.

Para elegir que valores agregar entre los píxeles, utilizaremos diferentes métodos
de interpolación.
\begin{itemize}
    \item \textit{Vecinos}: Consiste en rellenar los nuevos frames replicando los
        valores de los píxeles del frame original más cercano.
    \item \textit{Interpolación Lineal}: Consiste en rellenar los píxeles utilizando
        interpolaciones lineales entre píxeles de frames originales consecutivos.
    \item \textit{Interpolación por Splines}: Consiste en rellenar los píxeles utilizando
        Splines entre píxeles de frames originales consecutivos. En este método,
        utilizaremos la información provista por todos los frames del video,
        y generaremos $k-1$ funciones, cada una de a lo sumo grado cúbico.
    \item \textit{Interpolación por Splines con tamaño de bloque variante}:
        Simliar al anterior, pero con la posibilidad de variar la cantidad de frames
        tomados en cuenta al generar las funciones.
\end{itemize}

En las siguientes secciones explicaremos con mayor detalle cada uno de los métodos.

\subsection{Vecinos}\label{Vecinos}
En este método, eligiremos para cada nuevo píxel el valor del frame original que se encuentre
más cercano.
Si definimos $c$ como la cantidad de frames a agregar entre cada par original, y
$g_0, \dots, g_{c-1}$ los nuevos frames. Tenemos que:
\begin{equation*}
    \begin{aligned}
        p(x,y,f_{i}) &= p(x,y,f_{i})\\
        p(x,y,g_{0}) &= p(x,y,f_{i})\\
        \vdots\\
        p(x,y,g_{c/2-1}) &= p(x,y,f_{i})\\
        p(x,y,g_{c/2}) &= p(x,y,f_{i+1})\\
        \vdots\\
        p(x,y,g_{c-1}) &= p(x,y,f_{i+1})\\
        p(x,y,f_{i+1}) &= p(x,y,f_{i+1})
    \end{aligned}
\end{equation*}

\subsection{Interpolación Fragmentaria Lineal}\label{Lineal}
En este método, buscaremos interpolar los píxeles de frames contiguos con una función
lineal. Para ello, construiremos un Polinomio Interpolante de grado 1 utilizando
\textit{diferencias divididas}, ya que ofrece una construcción más sencilla que al seguir
el método de Lagrange.

Luego, si llamamos $f$ a la función (desconocida excepto en los puntos $x_j$), definimos:
\begin{itemize}
    \item Diferencia dividida de orden cero en $x_j$:
        \begin{equation*}
            f[x_j] = f(x_j)
        \end{equation*}
    \item Diferencia dividida de orden uno en $x_j$, $x_{j+1}$:
        \begin{equation*}
            f[x_j,x_{j+1}]= \frac{f[x_{j+1}] - f[x_j]}{x_{j+1} - x_j} = \frac{f(x_{j+1}) - f(x_j)}{x_{j+1} - x_j}
        \end{equation*}
    \item Polinomio Interpolante de grado 1 para $x_j$, $x_{j+1}$:
        \begin{equation*}
            P_1(x) = f[x_j] + f[x_j,x_{j+1}](x-x_j) = f(x_j) + \frac{f(x_{j+1}) - f(x_j)}{x_{j+1} - x_j}*(x-x_j)
        \end{equation*}
\end{itemize}

\subsection{Interpolación por Splines}\label{Splines}

El método de interpolación por splines se basa en dados $n$ puntos la
construcción de $n - 1$ funciones que interpolan los puntos y además cumplen
una serie de condiciones que aseguran que la función por tramos resultante no
posea las irregularidades de trabajar con polinomios de alto grado generando
además uniones suaves entre cada segmento.

~

Dada una función $f$ definida en el intervalo $[a, b]$ y un conjunto de nodos $a
= x_0 < x_1 < \dots < x_n = b$.

\begin{enumerate}
	\item Definimos $S(x)$ como un
	polinomio cúbico denominándolo $S_j(x)$ en el subintervalo $[x_j, x_{j+1}]$
	con $j \in [0, \dots, n - 1]$.

	\item $S_j(x_j) = f(x_j)$ y $S_j(x_{j+1}) = f(x_{j+1})$ para todo $j \in [0, \dots, n - 1]$.
	\item $S_j(x_{j+1}) = S_j(x_{j+1})$ para todo $j \in [0, \dots, n - 2]$.
	\item $S'_j(x_{j+1}) = S'_j(x_{j+1})$ para todo $j \in [0, \dots, n - 2]$.
	\item $S''_j(x_{j+1}) = S''_j(x_{j+1})$ para todo $j \in [0, \dots, n - 2]$.
	\item Por último, se cumple una de la siguientes condiciones
		\begin{enumerate}
			\item $S''(x_0) = S''(x_n) = 0$ (natural o de libre
				frontera).\label{splines_item_6b}
			\item $S'(x_0) = f'(x_0)$ y $S'(x_n) = f'(x_n)$ (sujeta).
		\end{enumerate}
\end{enumerate}

Un spline definido en un intervalo que está dividido en $n$ subintervalos
requiere determinar $4n$ constantes. Se aplican las condiciones descritas previamente a los siguiente
polinomios cúbicos:

\begin{gather*}
	S_j(x) = a_j + b_j(x - x_j) + c_j(x - x_j)^2 + d_j(x - x_j)^3 \\
	\text{para cada } j \in [0, \dots, n - 1]
\end{gather*}

Para este trabajo, dado que no conocemos la función $f$ que estamos
interpolando se decidió utilizar la condición \ref{splines_item_6b}, que define
al spline como natural o libre.

\cite{Burden}
Una vez establecidas las ecuaciones resultantes de aplicar las condiciones y
despejando todas las variables en función de $c_j$ nos quedan las siguientes
igualdades:

\begin{align*}
	h_j &= x_{j+1} - x_j \\
	a_j &= f(x_j) \text{ para cada } j \in [0, \dots, n] \\
	b_j &= \frac{a_{j+1}-a_j}{h_j} - \frac{2c_jh_j - c_{j+1}h_j}{3} \\
	d_j &= \frac{c_{j+1} - c_j}{3h_j} \\
		&\text{para cada } j \in [0, \dots, n - 1]
\end{align*}

Donde los $c_j$ nos quedan determinados por el siguiente sistema de ecuaciones:

\begin{align*}
	&c_0 = 0 \\
	&c_n = 0 \\
	&h_{j-1}c_{j-1} + 2(h_{j-1} + h_j)c_j + h_jc_{j+1} = \frac{3(a_{j+1} - a_j)}{h_j} + \frac{3(a_{j-1} - a_j)}{h_{j-1}} \\
		&\text{para cada } j \in [1, \dots, n - 1]
\end{align*}

El mismo se puede representar como la siguiente matriz:

\setlength{\arraycolsep}{2pt}
\kbordermatrix{
	&c_0	&c_1	&c_2	&\dots	&c_{j-1}	&c_j	&c_{j+1}	&\dots	&c_{n-2}	&c_{n-1}	&c_n	&		&b \\
c_0	&1		&0		&0		&\dots	&0			&0		&0			&\dots	&0			&0			&0		&\vrule	&0 \\
c_1	&h_0	&2(h_0+h_1) &h_1	&\dots	&0		&0		&0			&\dots	&0			&0			&0		&\vrule	&\frac{3(a_2 - a_1)}{h_1} + \frac{3(a_0 - a_1)}{h_0} \\
\vdots	&\vdots	&\vdots	&\vdots	&\vdots	&\vdots		&\vdots	&\vdots		&\vdots	&\vdots		&\vdots		&\vdots &\vrule	&\vdots \\
c_j	&0		&0		&0		&\dots	&h_{j-1} &2(h_{j-1}+h_j) &h_j	&\dots	&0			&0			&0		&\vrule	&\frac{3(a_{j+1} - a_j)}{h_j} + \frac{3(a_{j-1} - a_j)}{h_{j-1}} \\
\vdots	&\vdots	&\vdots	&\vdots	&\vdots	&\vdots		&\vdots	&\vdots		&\vdots	&\vdots		&\vdots		&\vdots	&\vrule	&\vdots \\
c_{n-1}	&0		&0		&0		&\dots	&0			&0		&0			&\dots	&h_{n-2}	&2(h_{n-2}+h_{n-1}) &h_{n-1} &\vrule &\frac{3(a_n - a_{n-1})}{h_{n-1}} + \frac{3(a_{n-2} - a_{n-1})}{h_{n-2}} \\
c_n	&0		&0		&0		&\dots	&0			&0		&0			&\dots	&0			&0			&1		&\vrule	&0
}

~

Ahora para el problema planteado, que es la interpolación de los cuadros de un
video, nuesto $h_j$ será la distancia entre cada uno de ellos. Esta distancia la
podemos pensar como el tiempo entre cada captura del video, y como la duración
del mismo se define por la cantidad de cuadros por segundo, podemos afirmar que
son equidistantes, por lo tanto tenemos $h_j = 1$ para todo $j \in [0, \dots,
n-1]$.

Reemplazando en la matriz anterior nos queda:

\setlength{\arraycolsep}{6pt}
\kbordermatrix{
	&c_0	&c_1	&c_2	&\dots	&c_{j-1}	&c_j	&c_{j+1}	&\dots	&c_{n-2}	&c_{n-1}	&c_n	&		&b \\
c_0	&1		&0		&0		&\dots	&0			&0		&0			&\dots	&0			&0			&0		&\vrule	&0 \\
c_1	&1		&4		&1		&\dots	&0			&0		&0			&\dots	&0			&0			&0		&\vrule	&3(a_2 - a_1) + 3(a_0 - a_1) \\
\vdots	&\vdots	&\vdots	&\vdots	&\vdots	&\vdots		&\vdots	&\vdots		&\vdots	&\vdots		&\vdots		&\vdots &\vrule	&\vdots \\
c_j	&0		&0		&0		&\dots	&1			&4		&1			&\dots	&0			&0			&0		&\vrule	&3(a_{j+1} - a_j) + 3(a_{j-1} - a_j) \\
\vdots	&\vdots	&\vdots	&\vdots	&\vdots	&\vdots		&\vdots	&\vdots		&\vdots	&\vdots		&\vdots		&\vdots	&\vrule	&\vdots \\
c_{n-1}	&0		&0		&0		&\dots	&0			&0		&0			&\dots	&1			&4			&1		&\vrule &3(a_n - a_{n-1}) + 3(a_{n-2} - a_{n-1}) \\
c_n	&0		&0		&0		&\dots	&0			&0		&0			&\dots	&0			&0			&1		&\vrule	&0
}

~

Como se puede observar resulta en una matriz cuadrada tridiagonal estrictamente dominante
por filas. Como consecuencia tenemos que la misma y sus submatrices principales
son inversibles, llevando a que el sistema tenga una única solución y que además
$A$ posea factorización $LU$.

Una vez que se tiene la factorización $A = LU$, sólo queda resolver el sistema
planteado y así calcular los coeficientes de cada $S_j(x)$. Por último resta
evaluar el spline en los puntos donde se agregaron cuadros nuevos para así poder
lograr el efecto buscado.

El beneficio de utilizar la factorización $LU$ es que el spline que se utiliza
para interpolar cada pixel del video comparte el mismo sistema, lo que cambia
son los valores de los $a_j$ que definen nuestro vector $b$. De esta manera,
recalculamos el vector $b$, utilizamos la factorización $LU$ para resolver el
sistema y nuevamente calculamos los coeficientes del spline.

\subsection{Interpolación por Splines con tamaño de bloque fijo}\label{MultiSplines}

Este método tiene el mismo fondo teórico que el anterior ya que también trabaja
con splines. La diferencia es que en el modelo anterior, dados todos los
valores que tomaba cada pixel del video se generaba un único spline para
cada pixel, mientras que con splines de a bloques lo que hacemos es para cada pixel
generar varios splines conectados entre si.

La motivación para realizar esto es la hipótesis de que si estamos trabajando
con un video que contiene cambios bruscos, el utilizar toda la duración del
video para alimentar un spline puede resultar impreciso, mientras que si
generamos splines asociados a tramos del video, creemos que podría comportarse
mejor a variaciones abruptas.

Dada una función $f$ definida en el intervalo $[a, b]$ y un conjunto de nodos $a
= x_0 < x_1 < \dots < x_n = b$, definimos $B$ como el tamaño de cada bloque y
$Sb(x)$ como un spline de a bloques con $Sb_j(x)$ siendo el spline definido en
el subintervalo $[x_j, x_{j+B}]$ con $j \in [0, \dots, n-B-1]$ que interpola los
puntos de $f$ en ese mismo intervalo.
